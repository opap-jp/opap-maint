#!/bin/bash

# 環境変数を読み込む

SCRIPT_DIR="$(dirname -- "$(readlink -f -- "$0")")"
. ${SCRIPT_DIR}/setenv

# プログラム情報

SCRIPT_NAME=$(basename "$0")
VERSION="1.0"

# ファイルパスなど
DBFILE=${DIR_SNAPSHOT}/id.db



######################
# 主処理
######################

sqlite3 ${DBFILE} <<EOM


CREATE TABLE IF NOT EXISTS snapshots (
	id		INTEGER PRIMARY KEY AUTOINCREMENT,
	mount_point	TEXT,
	snap_name	TEXT,
	ins_timestamp	TIMESTAMP
);

EOM

if [ $? -ne 0 ]; then
	exit 1
fi

sqlite3 ${DBFILE} <<EOM

BEGIN;

INSERT INTO snapshots
(	
	mount_point, 
	snap_name, 
	ins_timestamp
) 
VALUES 
(
	'$1',
	'$2',
	CURRENT_TIMESTAMP
);

SELECT MAX(id) 
FROM snapshots;

END;

EOM

if [ $? -ne 0 ]; then
	exit 1
fi

exit 0


