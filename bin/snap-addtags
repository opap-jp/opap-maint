#!/bin/bash

# 環境変数を読み込む

SCRIPT_DIR="$(dirname -- "$(readlink -f -- "$0")")"
. ${SCRIPT_DIR}/setenv

# プログラム情報

SCRIPT_NAME=$(basename "$0")
VERSION="1.0"

# ファイルパスなど
DBFILE=${DIR_SNAPSHOT}/id.db



######################
# 主処理
######################

sqlite3 ${DBFILE} <<EOM


CREATE TABLE IF NOT EXISTS snapshot_tags (
	snapshot_id	INTEGER PRIMARY KEY,
	tag		TEXT    PRIMARY KEY
);

EOM


snap_id=$1
shift

while [ -n $1 ];
do

    sqlite3 ${DBFILE} <<EOM

BEGIN;

DELETE FROM snapshot_tags
WHERE snapshot_id = ${snap_id}
  AND tag         = '$1'
;

INSERT INTO snapshot_tags
(	
	snapshot_id, 
	tag, 
) 
VALUES 
(
	${snap_id},
	'$1'
);


END;

EOM

    if [ $? -ne 0 ]; then
        exit 1
    fi

    shift
done

exit 0

